{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/Matt/Documents/Programming Practice/Raptor Maps/tech-tracker/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/Matt/Documents/Programming Practice/Raptor Maps/tech-tracker/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:/Users/Matt/Documents/Programming Practice/Raptor Maps/tech-tracker/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/Matt/Documents/Programming Practice/Raptor Maps/tech-tracker/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"C:/Users/Matt/Documents/Programming Practice/Raptor Maps/tech-tracker/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:/Users/Matt/Documents/Programming Practice/Raptor Maps/tech-tracker/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\Matt\\\\Documents\\\\Programming Practice\\\\Raptor Maps\\\\tech-tracker\\\\src\\\\index.js\";\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport mapboxgl from 'mapbox-gl/dist/mapbox-gl-csp';\nimport MapboxWorker from 'worker-loader!mapbox-gl/dist/mapbox-gl-csp-worker';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nmapboxgl.workerClass = MapboxWorker;\nmapboxgl.accessToken = 'pk.eyJ1IjoidHJtYXR0ayIsImEiOiJja210dGd2cjYwdXRzMnhzOTN1MDRsYnI2In0.OdQglh6qpMq-QQOm12p8Ng';\nvar currentMarkers = [];\n\nvar Map = /*#__PURE__*/function (_React$Component) {\n  _inherits(Map, _React$Component);\n\n  var _super = _createSuper(Map);\n\n  // class for the map\n  function Map(props) {\n    var _this;\n\n    _classCallCheck(this, Map);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      lng: -115.61,\n      // starting coordinates\n      lat: 32.67,\n      zoom: 12,\n      poll: 0\n    };\n    _this.mapContainer = /*#__PURE__*/React.createRef();\n    return _this;\n  }\n\n  _createClass(Map, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _this2 = this;\n\n        var _this$state, lng, lat, zoom, map, url, response, data, locations;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this$state = this.state, lng = _this$state.lng, lat = _this$state.lat, zoom = _this$state.zoom;\n                map = new mapboxgl.Map({\n                  container: this.mapContainer.current,\n                  style: 'mapbox://styles/mapbox/streets-v11',\n                  center: [lng, lat],\n                  zoom: zoom\n                });\n                url = 'http://localhost:5000/' + this.state.poll; // CHANGE TO CONST?\n\n                _context.next = 5;\n                return fetch(url);\n\n              case 5:\n                response = _context.sent;\n                _context.next = 8;\n                return response.json();\n\n              case 8:\n                data = _context.sent;\n                locations = data.features;\n                locations.forEach(function (technician) {\n                  var el = document.createElement('div');\n                  el.className = 'marker';\n                  var newMarker = new mapboxgl.Marker(el).setLngLat(technician.geometry.coordinates) // position\n                  .setRotation(technician.properties.bearing) // bearing\n                  .setPopup(new mapboxgl.Popup({\n                    offset: 25,\n                    closeButton: false\n                  }).setText(technician.properties.name)).addTo(map);\n                  currentMarkers.push(newMarker);\n                });\n                this.setState({\n                  poll: this.state.poll + 1\n                });\n                console.log(this.state.poll); // DELETE BEFORE SUBMISSION\n\n                map.on('move', function () {\n                  // get new map coordinates\n                  _this2.setState({\n                    lng: map.getCenter().lng.toFixed(4),\n                    lat: map.getCenter().lat.toFixed(4),\n                    zoom: map.getZoom().toFixed(2)\n                  });\n                });\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"updateLocations\",\n    value: function () {\n      var _updateLocations = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var url, response, data, locations, i, _i, j, lat1, lng1, lat2, lng2;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                // get new locations from API\n                url = 'http://localhost:5000/' + this.state.poll; // CHANGE TO CONST?\n\n                _context2.next = 3;\n                return fetch(url);\n\n              case 3:\n                response = _context2.sent;\n                _context2.next = 6;\n                return response.json();\n\n              case 6:\n                data = _context2.sent;\n                locations = data.features; // update marker locations or add new markers\n\n                for (i = 0; i < locations.length; i++) {\n                  currentMarkers[i].setLngLat(locations[i].geometry.coordinates).setRotation(locations[i].properties.bearing);\n                }\n\n                ; // notify when technicians are close to each other\n\n                for (_i = 0; _i < currentMarkers.length; _i++) {\n                  for (j = _i; j < currentMarkers.length; j++) {\n                    if (_i !== j) {\n                      lat1 = currentMarkers[_i].getLngLat().lat;\n                      lng1 = currentMarkers[_i].getLngLat().lng;\n                      lat2 = currentMarkers[j].getLngLat().lat;\n                      lng2 = currentMarkers[j].getLngLat().lng;\n\n                      if (haversineDist(lat1, lng1, lat2, lng2) < 1000) {\n                        currentMarkers[_i].setPopup(new mapboxgl.Popup({\n                          offset: 25,\n                          closeButton: false\n                        }).setText(locations[_i].properties.name + ' close to ' + locations[j].properties.name)).togglePopup();\n                      } else {\n                        currentMarkers[_i].setPopup(new mapboxgl.Popup({\n                          offset: 25,\n                          closeButton: false\n                        }).setText(locations[_i].properties.name));\n\n                        currentMarkers[j].setPopup(new mapboxgl.Popup({\n                          offset: 25,\n                          closeButton: false\n                        }).setText(locations[j].properties.name));\n                      }\n\n                      ;\n                    }\n                  }\n                }\n\n                this.setState({\n                  poll: this.state.poll + 1\n                });\n                console.log(this.state.poll); // DELETE BEFORE SUBMISSION\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function updateLocations() {\n        return _updateLocations.apply(this, arguments);\n      }\n\n      return updateLocations;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state2 = this.state,\n          lng = _this$state2.lng,\n          lat = _this$state2.lat,\n          zoom = _this$state2.zoom;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"sidebar\",\n          children: [\"Longitude: \", lng, \" | Latitude: \", lat, \" | Zoom: \", zoom]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"poll-button\",\n          onClick: function onClick() {\n            return _this3.updateLocations();\n          },\n          children: \"Update\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: this.mapContainer,\n          className: \"map-container\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return Map;\n}(React.Component);\n\nfunction haversineDist(lat1, lng1, lat2, lng2) {\n  // calculate Haversine distance between two GPS points\n  var earthRadiusFt = 20902259;\n  var latDist = (lat1 - lat2) * Math.PI / 180;\n  var lngDist = (lng1 - lng2) * Math.PI / 180;\n  lat1 = lat1 * Math.PI / 180;\n  lat2 = lat2 * Math.PI / 180;\n  var a = Math.pow(Math.sin(latDist / 2), 2) + Math.pow(Math.sin(lngDist / 2), 2) * (Math.cos(lat1) * Math.cos(lat2));\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return earthRadiusFt * c;\n} // ===========================================\n\n\nReactDOM.render( /*#__PURE__*/_jsxDEV(Map, {}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 158,\n  columnNumber: 3\n}, this), document.getElementById('app'));","map":{"version":3,"sources":["C:/Users/Matt/Documents/Programming Practice/Raptor Maps/tech-tracker/src/index.js"],"names":["React","ReactDOM","mapboxgl","MapboxWorker","workerClass","accessToken","currentMarkers","Map","props","state","lng","lat","zoom","poll","mapContainer","createRef","map","container","current","style","center","url","fetch","response","json","data","locations","features","forEach","technician","el","document","createElement","className","newMarker","Marker","setLngLat","geometry","coordinates","setRotation","properties","bearing","setPopup","Popup","offset","closeButton","setText","name","addTo","push","setState","console","log","on","getCenter","toFixed","getZoom","i","length","j","lat1","getLngLat","lng1","lat2","lng2","haversineDist","togglePopup","updateLocations","Component","earthRadiusFt","latDist","Math","PI","lngDist","a","sin","cos","c","atan2","sqrt","render","getElementById"],"mappings":"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","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport mapboxgl from 'mapbox-gl/dist/mapbox-gl-csp';\nimport MapboxWorker from 'worker-loader!mapbox-gl/dist/mapbox-gl-csp-worker';\n\nmapboxgl.workerClass = MapboxWorker;\nmapboxgl.accessToken = 'pk.eyJ1IjoidHJtYXR0ayIsImEiOiJja210dGd2cjYwdXRzMnhzOTN1MDRsYnI2In0.OdQglh6qpMq-QQOm12p8Ng';\n\nvar currentMarkers = [];\n\nclass Map extends React.Component { // class for the map\n  constructor(props) {\n    super(props);\n    this.state = {\n      lng: -115.61, // starting coordinates\n      lat: 32.67,\n      zoom: 12,\n      poll: 0\n    };\n    this.mapContainer = React.createRef();\n  }\n\n  async componentDidMount() {\n    const {lng, lat, zoom} = this.state;\n    const map = new mapboxgl.Map({\n      container: this.mapContainer.current,\n      style: 'mapbox://styles/mapbox/streets-v11',\n      center: [lng, lat],\n      zoom: zoom\n    });\n\n    var url = 'http://localhost:5000/' + this.state.poll // CHANGE TO CONST?\n    var response = await fetch(url);\n    var data = await response.json();\n    var locations = data.features;\n\n    locations.forEach(function(technician) {\n      var el = document.createElement('div');\n      el.className = 'marker';\n\n      var newMarker = new mapboxgl.Marker(el)\n        .setLngLat(technician.geometry.coordinates) // position\n        .setRotation(technician.properties.bearing) // bearing\n        .setPopup(new mapboxgl.Popup({\n          offset: 25,\n          closeButton: false,\n        })\n        .setText(technician.properties.name))\n        .addTo(map)\n      currentMarkers.push(newMarker);\n    });\n\n    this.setState({\n      poll: this.state.poll + 1\n    });\n\n    console.log(this.state.poll); // DELETE BEFORE SUBMISSION\n\n    map.on('move', () => { // get new map coordinates\n      this.setState({\n        lng: map.getCenter().lng.toFixed(4),\n        lat: map.getCenter().lat.toFixed(4),\n        zoom: map.getZoom().toFixed(2)\n      });\n    });\n  }\n\n  async updateLocations() {\n    // get new locations from API\n    var url = 'http://localhost:5000/' + this.state.poll; // CHANGE TO CONST?\n    var response = await fetch(url);\n    var data = await response.json();\n    var locations = data.features;\n\n    // update marker locations or add new markers\n    for (let i = 0; i < locations.length; i++) {\n      currentMarkers[i]\n        .setLngLat(locations[i].geometry.coordinates)\n        .setRotation(locations[i].properties.bearing)\n    };\n\n    // notify when technicians are close to each other\n    for (let i = 0; i < currentMarkers.length; i++) {\n      for (var j = i; j < currentMarkers.length; j++) {\n        if (i !== j) {\n          const lat1 = currentMarkers[i].getLngLat().lat;\n          const lng1 = currentMarkers[i].getLngLat().lng;\n          const lat2 = currentMarkers[j].getLngLat().lat;\n          const lng2 = currentMarkers[j].getLngLat().lng;\n          if (haversineDist(lat1, lng1, lat2, lng2) < 1000) {\n            currentMarkers[i]\n              .setPopup(new mapboxgl.Popup({\n                offset: 25,\n                closeButton: false,\n              })\n              .setText(locations[i].properties.name + ' close to ' + locations[j].properties.name))\n              .togglePopup()\n          } else {\n            currentMarkers[i]\n              .setPopup(new mapboxgl.Popup({\n                offset: 25,\n                closeButton: false,\n              })\n              .setText(locations[i].properties.name))\n            currentMarkers[j]\n              .setPopup(new mapboxgl.Popup({\n                offset: 25,\n                closeButton: false,\n              })\n              .setText(locations[j].properties.name))\n          };\n        }\n      }\n    }\n\n    this.setState({\n      poll: this.state.poll + 1\n    });\n\n    console.log(this.state.poll); // DELETE BEFORE SUBMISSION\n  }\n\n  render() {\n    const {lng, lat, zoom} = this.state;\n    return (\n      <div>\n        <div className=\"sidebar\">\n          Longitude: {lng} | Latitude: {lat} | Zoom: {zoom}\n        </div>\n        <button className=\"poll-button\" onClick={() => this.updateLocations()}>\n          Update\n        </button>\n        <div ref={this.mapContainer} className=\"map-container\" />\n        </div>\n    );\n  }\n}\n\nfunction haversineDist(lat1, lng1, lat2, lng2) { // calculate Haversine distance between two GPS points\n  const earthRadiusFt = 20902259;\n\n  const latDist = (lat1 - lat2) * Math.PI / 180;\n  const lngDist = (lng1 - lng2) * Math.PI / 180;\n\n  lat1 = lat1 * Math.PI / 180;\n  lat2 = lat2 * Math.PI / 180;\n\n  const a = (Math.sin(latDist / 2) ** 2) +\n            (Math.sin(lngDist / 2) ** 2) *\n            (Math.cos(lat1) * Math.cos(lat2));\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return earthRadiusFt * c;\n}\n\n// ===========================================\n\nReactDOM.render(\n  <Map />,\n  document.getElementById('app')\n);\n"]},"metadata":{},"sourceType":"module"}